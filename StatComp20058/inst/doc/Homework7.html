<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Xinyu Li" />

<meta name="date" content="2020-12-16" />

<title>Homework7</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Homework7</h1>
<h4 class="author">Xinyu Li</h4>
<h4 class="date">2020-12-16</h4>



<div id="question" class="section level3">
<h3>question</h3>
<p>Exercise 8.3 (page 243, Statistical Computating with R). Design experiments for evaluating the performance of the NN,</p>
</div>
<div id="answer" class="section level3">
<h3>answer</h3>
<div id="exercise-8.3" class="section level4">
<h4><strong>Exercise 8.3</strong></h4>
<p>The Count 5 test for equal variances in Section 6.4 is based on the maximum number of extreme points. Example 6.15 shows that the Count 5 criterion is not applicable for unequal sample sizes. Implement a permutation test for equal variance based on the maximum number of extreme points that applies when sample sizes are not necessarily equal.</p>
<div id="solution" class="section level5">
<h5>solution:</h5>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="kw">library</span>(boot)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a><span class="kw">library</span>(energy)</span></code></pre></div>
<pre><code>## Warning: package &#39;energy&#39; was built under R version 4.0.3</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a><span class="kw">library</span>(MASS)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true"></a>maxout &lt;-<span class="st"> </span><span class="cf">function</span>(x, y) {</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true"></a>  X &lt;-<span class="st"> </span>x <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(x)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true"></a>  Y &lt;-<span class="st"> </span>y <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(y)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true"></a>  outx &lt;-<span class="st"> </span><span class="kw">sum</span>(X <span class="op">&gt;</span><span class="st"> </span><span class="kw">max</span>(Y)) <span class="op">+</span><span class="st"> </span><span class="kw">sum</span>(X <span class="op">&lt;</span><span class="st"> </span><span class="kw">min</span>(Y))</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true"></a>  outy &lt;-<span class="st"> </span><span class="kw">sum</span>(Y <span class="op">&gt;</span><span class="st"> </span><span class="kw">max</span>(X)) <span class="op">+</span><span class="st"> </span><span class="kw">sum</span>(Y <span class="op">&lt;</span><span class="st"> </span><span class="kw">min</span>(X))</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true"></a>  <span class="kw">return</span>(<span class="kw">max</span>(<span class="kw">c</span>(outx, outy))) </span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true"></a>}</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true"></a>n1 &lt;-<span class="dv">20</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true"></a>n2 &lt;-<span class="dv">30</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true"></a>mu1 &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true"></a>mu2 &lt;-<span class="st"> </span><span class="dv">4</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true"></a>sigma1 &lt;-<span class="dv">1</span> </span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true"></a>sigma2 &lt;-<span class="st"> </span><span class="dv">6</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true"></a>x &lt;-<span class="st"> </span><span class="kw">rnorm</span>(n1, mu1, sigma1)</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true"></a>y &lt;-<span class="st"> </span><span class="kw">rnorm</span>(n2, mu2, sigma2)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true"></a>d0&lt;-<span class="kw">maxout</span>(x, y)</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true"></a>R &lt;-<span class="st"> </span><span class="dv">999</span> <span class="co">#number of replicates</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true"></a>z &lt;-<span class="st"> </span><span class="kw">c</span>(x, y) <span class="co">#pooled sample</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true"></a>K &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">50</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true"></a>reps &lt;-<span class="st"> </span><span class="kw">numeric</span>(R) <span class="co">#storage for replicates</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>R) {</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true"></a>  k &lt;-<span class="st"> </span><span class="kw">sample</span>(K, <span class="dt">size =</span> <span class="dv">10</span>, <span class="dt">replace =</span> <span class="ot">FALSE</span>)</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true"></a>  x1 &lt;-<span class="st"> </span>z[k]</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true"></a>  y1 &lt;-<span class="st"> </span>z[<span class="op">-</span>k] <span class="co">#complement of x1</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true"></a>  reps[i] &lt;-<span class="st"> </span><span class="kw">maxout</span>(x1, y1)</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true"></a>}</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true"></a>p &lt;-<span class="st"> </span><span class="kw">mean</span>(<span class="kw">c</span>(d0, reps) <span class="op">&gt;=</span><span class="st"> </span>d0)</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true"></a>p</span></code></pre></div>
<pre><code>## [1] 0.026</code></pre>
<p>It can be seen from the results: 0.026&lt;0.05, which means that the null hypothesis is rejected at this level of significance, indicating that it comes from two different distributions, and it also corrects and improves the shortcomings of the different samples of Count 5 test.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a><span class="kw">hist</span>(reps, <span class="dt">breaks =</span> <span class="st">&quot;scott&quot;</span>,<span class="dt">main =</span> <span class="st">&quot;Histogram&quot;</span>,<span class="dt">xlab =</span> <span class="st">&quot;a&quot;</span>,<span class="dt">col=</span><span class="st">&quot;black&quot;</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true"></a><span class="kw">points</span>(d0, <span class="dv">0</span>, <span class="dt">cex =</span> <span class="dv">1</span>, <span class="dt">pch =</span> <span class="dv">16</span>,<span class="dt">col=</span><span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASAAAAEgCAMAAAAjXV6yAAAArlBMVEUAAAAAADoAAGYAOjoAOmYAOpAAZpAAZrY6AAA6ADo6AGY6OgA6Ojo6OmY6OpA6ZpA6ZrY6kLY6kNtmAABmADpmOgBmOjpmkLZmkNtmtttmtv+QOgCQZgCQZjqQkGaQkLaQtpCQttuQtv+Q2/+2ZgC2Zjq2ZpC2kGa225C229u22/+2///bkDrbkGbbtmbbtpDb27bb29vb////AAD/tmb/25D/27b//7b//9v///+MUEumAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAHvUlEQVR4nO2da0PbNhiFFQaDjXUXUrqV7I67S3BLB4HE//+PTdcQkkhHjmXHls/zgUJiKdZT6ZVsS4qoSBBx7BPoOxQEoCAABQEoCEBBAAoCUBCAggAUBKAgAAUBKAhAQQAKAlAQgIIAFASgIAAFASgIQEEACgJQEICCABQEoCAABQEoCEBBAAoCUBDgGIJWM3H2YP49X/+x8fZfd0c4KR/9E/R8fUJBG4J2KAQF7alBHy+FmHw3V34kStH9OyG++FFXrtUHIU5vtblSTH6/Fifz6v5aHvfmtqqWU3F+fykm76uPF/Ko1CfbE0GlEFaME2RfUQfKQySTy5eXzx4W5u3JrRJkuHRqk3IkQQ4rSNWCh+qTEFeuiT1dWG/yFSnj/GFVOG9n8+o/merLB3XQlRZ0pdKK9/b4pPRDkCzp6b/2XSPIRqLCVCr1uxRhBN3YAz//fakykK9LleanNpaWfggyr5iIo3W4VihDzq373cUgHWZWv7gMVO2r7M98BG3HoOdrE1L+tB5MeXXrunG/bwpSRk9/+zwdjSA5/Pn10sTkqBpkTCzHJEj9/fNLxPHHIC1ooUORC9L5C5Ll/UG3M91zKQX+XszVoLOH59l4YtCH9bBG6QiOg9YxaFRBuvqkItCbeWWHzXM7kv7JJJAvfTvf6cVO/yjlSxkKOpBi+7K/E4YgSEaf73Xt2HNp2zpDEGSvu2zj6pghCKqe313Ya/3uGYSgY0JBAAoCUBCAggAUBKAgAAUBKAhAQQAKAlAQgIIAFASgIAAFASgIQEEACgJQEICCABQEoCAABQEoCEBBAAoCUBCAggAUBKAgQOuCxAZtf1YbUBCAggAUBKAgQL2TdhPcwbo+4aHJiR6LWiddunnsi/CE9rEKWs3WWsrgpPexClpO3WrIahFsZGMVxBqEKN2CWsYgD26NOlh2M15BsZlSEMh0tILGPFB0q9NDjHygqJbRBsvNbh448g8UtxzkK8go8kWYiBqUuSC1OPRGevC1HzxQzFmQGgQaM/4LLThQzFjQcppiUXHGglJml6mgQjYcMMAphd0AqvS0wpwFFTqwLKeB4WKp91RTBxwmaIiuNmKQ6aECt8JMN687uREKcoMcX9GrF4eyro1QkB3kPF34g9B6oFicj1GQ2l4FbCDitJjdsvzZZSooAjeUXs0oqEl2eQqKvBkWk12egooU+8RmLGg5TbE9WtaCbkLH1couS0GrWYot1DIWJK9TE1ShjAWtN/ZmL/YKjoMAac50q+CZCtK7nhfNOvucBS0mt6Xafr+RoYwFqXsZZeBWWJ3sshSkBopKUHhyXVx2WQpyNahotCdxxoJsDCqbDRdzFmSGig2fHmYtKF124xUEb6plLCjmWgzPMMtYkCXUyzeeHzREVzunV/hvC0UsRRiBIPjoWTPiGhS61Gg6wywHQcHZHU1nmA1aUOQyjKjsshSUMrvxCko3UByeoPVAMVD+hAPF4Qmyj31CV/Pj7uZXM2MmsAqj8VKEQQtavjU3OjhQfM1ODQrdUWxnoNhvV6/uKFZmpq+fVgaKQxFkSt/wW/KyFpQuOwoC2WUqqNNHzwMUhB89Rwy2MxYU8+jZOz16K7ssBUU9eobz9DIWFPfoGc3Ty1hQx4+eByio20fPQxSULrssBW1cqjfOLktBHc+0H56ghlPLXmWXpaCOJ5IPT1DK7CgIZJefoDQRuspcUIOOfquIFASyoyCQ3cGCeiiLggAUBKAggBP0cmLHHEn3VlDi7JII6okrCooqUeLsKAhkR0EgOwoC2VEQyC61oGO6oqCoEiXOjoJAdi0K6twVBUWVKJZWliLU5fHxsa+C2lmKUN+PMdSo3NHU+ZiWJpIf4MfWIUQjM69KFEdLSxHqUUfQftoTFP29Gm1iBXX2eTVjUNzXZ7VKt35q9mJp1m02pFM/qcdB+dGKoCTROBVNy5LESI1M+/ReDBQEoCAABQEoCEBBAAoCUBCAggC81ABQEICCABQEoCAABQEoCEBBAAoCUBCAggAUBKAgQHpBC//2Dea54979UZ6+vgOJ96Bn41zVT1eH5ILUXnELz8k+feUrxHKqZ0OEEu+ymslDSyW8XrpapBZkJjh4tjX3Ls1fmDlZwcS7PF3ovUNP7mqmq0VqQeuT3vdm6SnCQlxpd8HEPmTNOShdJMkF6VbkqSrFNy5m7GAEhRL7KE7uDkoXSWpBJhLsjwfLqZoVsn8bOV26UGLvB0rjh6SLpUtB9oi9/9GHClq4GD0UQbi2m4CxzYFNzMzkGlITw/Fyf19/WJC2026HFKRDPa4pR6CJ1e2uX77dfTjdfHDMposQCNI1B3xPFy6rAQ0U1X+rf9RfyG5+/zYqtl6FEu/7JIVKUCtdLXixCqAgAAUBKAhAQQAKAlAQgIIAFASgIAAFASgIQEEACgJQEICCABQEoCAABQEoCEBBAAoCUBCAggAUBKAgAAUBKAhAQQAKAvRekH/GTDf0XZCacxX+iveW6bmg5dtb37TPjui5IMXiqG2s74JKIU7+YQ3yolsXm5gfMwGfTcyLqjzL6RE3Ru27IDO/tzhiP993QUeHggAUBKAgAAUBKAhAQQAKAlAQgIIAFASgIAAFASgIQEEACgJQEICCABQEoCAABQEoCEBBAAoC/A/5UXRCNQCH/wAAAABJRU5ErkJggg==" /><!-- --></p>
</div>
</div>
<div id="exercise-1" class="section level4">
<h4><strong>Exercise 1</strong></h4>
<p>Design experiments for evaluating the performance of the NN,energy, and ball methods in various situations. ##### solution: I Unequal variances and equal expectations: variances= 2 and 1,expectations=0</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true"></a><span class="kw">library</span>(Ball)</span></code></pre></div>
<pre><code>## Warning: package &#39;Ball&#39; was built under R version 4.0.3</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true"></a><span class="kw">library</span>(RANN)</span></code></pre></div>
<pre><code>## Warning: package &#39;RANN&#39; was built under R version 4.0.3</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true"></a>Tn &lt;-<span class="st"> </span><span class="cf">function</span>(z, ix, sizes,k) {</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true"></a>  n1 &lt;-<span class="st"> </span>sizes[<span class="dv">1</span>]; n2 &lt;-<span class="st"> </span>sizes[<span class="dv">2</span>]; n &lt;-<span class="st"> </span>n1 <span class="op">+</span><span class="st"> </span>n2</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true"></a>  <span class="cf">if</span>(<span class="kw">is.vector</span>(z)) z &lt;-<span class="st"> </span><span class="kw">data.frame</span>(z,<span class="dv">0</span>);</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true"></a>  z &lt;-<span class="st"> </span>z[ix, ];</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true"></a>  NN &lt;-<span class="st"> </span><span class="kw">nn2</span>(<span class="dt">data=</span>z, <span class="dt">k=</span>k<span class="op">+</span><span class="dv">1</span>) <span class="co"># what&#39;s the first column?</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true"></a>  block1 &lt;-<span class="st"> </span>NN<span class="op">$</span>nn.idx[<span class="dv">1</span><span class="op">:</span>n1,<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true"></a>  block2 &lt;-<span class="st"> </span>NN<span class="op">$</span>nn.idx[(n1<span class="op">+</span><span class="dv">1</span>)<span class="op">:</span>n,<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true"></a>  i1 &lt;-<span class="st"> </span><span class="kw">sum</span>(block1 <span class="op">&lt;</span><span class="st"> </span>n1 <span class="op">+</span><span class="st"> </span><span class="fl">.5</span>); i2 &lt;-<span class="st"> </span><span class="kw">sum</span>(block2 <span class="op">&gt;</span><span class="st"> </span>n1<span class="fl">+.5</span>)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true"></a>  (i1 <span class="op">+</span><span class="st"> </span>i2) <span class="op">/</span><span class="st"> </span>(k <span class="op">*</span><span class="st"> </span>n)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true"></a>}</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true"></a>m &lt;-<span class="st"> </span><span class="fl">1e3</span>; k&lt;-<span class="dv">3</span>; p&lt;-<span class="dv">2</span>;<span class="kw">set.seed</span>(<span class="dv">12345</span>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true"></a>n1 &lt;-<span class="st"> </span>n2 &lt;-<span class="st"> </span><span class="dv">50</span>; R&lt;-<span class="dv">999</span>; n &lt;-<span class="st"> </span>n1<span class="op">+</span>n2; N =<span class="st"> </span><span class="kw">c</span>(n1,n2)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true"></a>eqdist.nn &lt;-<span class="st"> </span><span class="cf">function</span>(z,sizes,k){</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true"></a>  boot.obj &lt;-<span class="st"> </span><span class="kw">boot</span>(<span class="dt">data=</span>z,<span class="dt">statistic=</span>Tn,<span class="dt">R=</span>R,</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true"></a>                   <span class="dt">sim =</span> <span class="st">&quot;permutation&quot;</span>, <span class="dt">sizes =</span> sizes,<span class="dt">k=</span>k)</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true"></a>  ts &lt;-<span class="st"> </span><span class="kw">c</span>(boot.obj<span class="op">$</span>t0,boot.obj<span class="op">$</span>t)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true"></a>  p.value &lt;-<span class="st"> </span><span class="kw">mean</span>(ts<span class="op">&gt;=</span>ts[<span class="dv">1</span>])</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true"></a>  <span class="kw">list</span>(<span class="dt">statistic=</span>ts[<span class="dv">1</span>],<span class="dt">p.value=</span>p.value)</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true"></a>}</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true"></a>p.values &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>,m,<span class="dv">3</span>)</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>m){</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true"></a>  x &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rnorm</span>(n2<span class="op">*</span>p,<span class="dv">0</span>,<span class="dv">2</span>),<span class="dt">ncol=</span>p);</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true"></a>  y &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="kw">rnorm</span>(n2,<span class="dv">0</span>,<span class="dv">2</span>),<span class="kw">rnorm</span>(n2,<span class="dv">0</span>,<span class="dv">1</span>));</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true"></a>  z &lt;-<span class="st"> </span><span class="kw">rbind</span>(x,y)</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true"></a>  p.values[i,<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw">eqdist.nn</span>(z,N,k)<span class="op">$</span>p.value</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true"></a>  p.values[i,<span class="dv">2</span>] &lt;-<span class="st"> </span><span class="kw">eqdist.etest</span>(z,<span class="dt">sizes=</span>N,<span class="dt">R=</span>R)<span class="op">$</span>p.value</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true"></a>  p.values[i,<span class="dv">3</span>] &lt;-<span class="st"> </span><span class="kw">bd.test</span>(<span class="dt">x=</span>x,<span class="dt">y=</span>y,<span class="dt">num.permutations=</span><span class="dv">999</span>,<span class="dt">seed=</span>i<span class="op">*</span><span class="dv">12345</span>)<span class="op">$</span>p.value</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true"></a>alpha &lt;-<span class="st"> </span><span class="fl">0.05</span>;</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true"></a>pow &lt;-<span class="st"> </span><span class="kw">colMeans</span>(p.values<span class="op">&lt;</span>alpha)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true"></a><span class="kw">matrix</span>(pow, <span class="dt">nrow=</span><span class="dv">1</span>,<span class="dt">dimnames=</span><span class="kw">list</span>(<span class="st">&quot;power&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;eqdist.nn&quot;</span>,<span class="st">&quot;eqdist.etest&quot;</span>,<span class="st">&quot;bd.test&quot;</span>)))</span></code></pre></div>
<pre><code>##       eqdist.nn eqdist.etest bd.test
## power     0.496        0.253   0.578</code></pre>
<p>The power of bd.test is better.</p>
<p>II Unequal variances and unequal expectations: variances= 1,expectations= 0 and 1</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true"></a><span class="kw">library</span>(Ball)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true"></a><span class="kw">library</span>(RANN)</span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true"></a>Tn &lt;-<span class="st"> </span><span class="cf">function</span>(z, ix, sizes,k) {</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true"></a>  n1 &lt;-<span class="st"> </span>sizes[<span class="dv">1</span>]; n2 &lt;-<span class="st"> </span>sizes[<span class="dv">2</span>]; n &lt;-<span class="st"> </span>n1 <span class="op">+</span><span class="st"> </span>n2</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true"></a>  <span class="cf">if</span>(<span class="kw">is.vector</span>(z)) z &lt;-<span class="st"> </span><span class="kw">data.frame</span>(z,<span class="dv">0</span>);</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true"></a>  z &lt;-<span class="st"> </span>z[ix, ];</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true"></a>  NN &lt;-<span class="st"> </span><span class="kw">nn2</span>(<span class="dt">data=</span>z, <span class="dt">k=</span>k<span class="op">+</span><span class="dv">1</span>) <span class="co"># what&#39;s the first column?</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true"></a>  block1 &lt;-<span class="st"> </span>NN<span class="op">$</span>nn.idx[<span class="dv">1</span><span class="op">:</span>n1,<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true"></a>  block2 &lt;-<span class="st"> </span>NN<span class="op">$</span>nn.idx[(n1<span class="op">+</span><span class="dv">1</span>)<span class="op">:</span>n,<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true"></a>  i1 &lt;-<span class="st"> </span><span class="kw">sum</span>(block1 <span class="op">&lt;</span><span class="st"> </span>n1 <span class="op">+</span><span class="st"> </span><span class="fl">.5</span>); i2 &lt;-<span class="st"> </span><span class="kw">sum</span>(block2 <span class="op">&gt;</span><span class="st"> </span>n1<span class="fl">+.5</span>)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true"></a>  (i1 <span class="op">+</span><span class="st"> </span>i2) <span class="op">/</span><span class="st"> </span>(k <span class="op">*</span><span class="st"> </span>n)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true"></a>}</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true"></a>m &lt;-<span class="st"> </span><span class="fl">1e3</span>; k&lt;-<span class="dv">3</span>; p&lt;-<span class="dv">2</span>;<span class="kw">set.seed</span>(<span class="dv">12345</span>)</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true"></a>n1 &lt;-<span class="st"> </span>n2 &lt;-<span class="st"> </span><span class="dv">50</span>; R&lt;-<span class="dv">999</span>; n &lt;-<span class="st"> </span>n1<span class="op">+</span>n2; N =<span class="st"> </span><span class="kw">c</span>(n1,n2)</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true"></a>eqdist.nn &lt;-<span class="st"> </span><span class="cf">function</span>(z,sizes,k){</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true"></a>  boot.obj &lt;-<span class="st"> </span><span class="kw">boot</span>(<span class="dt">data=</span>z,<span class="dt">statistic=</span>Tn,<span class="dt">R=</span>R,</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true"></a>                   <span class="dt">sim =</span> <span class="st">&quot;permutation&quot;</span>, <span class="dt">sizes =</span> sizes,<span class="dt">k=</span>k)</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true"></a>  ts &lt;-<span class="st"> </span><span class="kw">c</span>(boot.obj<span class="op">$</span>t0,boot.obj<span class="op">$</span>t)</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true"></a>  p.value &lt;-<span class="st"> </span><span class="kw">mean</span>(ts<span class="op">&gt;=</span>ts[<span class="dv">1</span>])</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true"></a>  <span class="kw">list</span>(<span class="dt">statistic=</span>ts[<span class="dv">1</span>],<span class="dt">p.value=</span>p.value)</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true"></a>}</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true"></a>p.values &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>,m,<span class="dv">3</span>)</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>m){</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true"></a>  x &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rnorm</span>(n2<span class="op">*</span>p),<span class="dt">ncol=</span>p);</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true"></a>  y &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="kw">rnorm</span>(n2,<span class="dv">0</span>,<span class="dv">1</span>),<span class="kw">rnorm</span>(n2,<span class="dv">1</span>,<span class="dv">1</span>));</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true"></a>  z &lt;-<span class="st"> </span><span class="kw">rbind</span>(x,y)</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true"></a>  p.values[i,<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw">eqdist.nn</span>(z,N,k)<span class="op">$</span>p.value</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true"></a>  p.values[i,<span class="dv">2</span>] &lt;-<span class="st"> </span><span class="kw">eqdist.etest</span>(z,<span class="dt">sizes=</span>N,<span class="dt">R=</span>R)<span class="op">$</span>p.value</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true"></a>  p.values[i,<span class="dv">3</span>] &lt;-<span class="st"> </span><span class="kw">bd.test</span>(<span class="dt">x=</span>x,<span class="dt">y=</span>y,<span class="dt">num.permutations=</span><span class="dv">999</span>,<span class="dt">seed=</span>i<span class="op">*</span><span class="dv">12345</span>)<span class="op">$</span>p.value</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true"></a>alpha &lt;-<span class="st"> </span><span class="fl">0.05</span>;</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true"></a>pow &lt;-<span class="st"> </span><span class="kw">colMeans</span>(p.values<span class="op">&lt;</span>alpha)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true"></a><span class="kw">matrix</span>(pow, <span class="dt">nrow=</span><span class="dv">1</span>,<span class="dt">dimnames=</span><span class="kw">list</span>(<span class="st">&quot;power&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;eqdist.nn&quot;</span>,<span class="st">&quot;eqdist.etest&quot;</span>,<span class="st">&quot;bd.test&quot;</span>)))</span></code></pre></div>
<pre><code>##       eqdist.nn eqdist.etest bd.test
## power     0.747        0.991   0.974</code></pre>
<p>The power of bd.test is better.</p>
<p>III Non-normal distributions: t distribution with 1 df (heavy-taileddistribution), bimodel distribution (mixture of two normal distributions)</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true"></a>Tn &lt;-<span class="st"> </span><span class="cf">function</span>(z, ix, sizes,k) {</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true"></a>  n1 &lt;-<span class="st"> </span>sizes[<span class="dv">1</span>]; n2 &lt;-<span class="st"> </span>sizes[<span class="dv">2</span>]; n &lt;-<span class="st"> </span>n1 <span class="op">+</span><span class="st"> </span>n2</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true"></a>  <span class="cf">if</span>(<span class="kw">is.vector</span>(z)) z &lt;-<span class="st"> </span><span class="kw">data.frame</span>(z,<span class="dv">0</span>);</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true"></a>  z &lt;-<span class="st"> </span>z[ix, ];</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true"></a>  NN &lt;-<span class="st"> </span><span class="kw">nn2</span>(<span class="dt">data=</span>z, <span class="dt">k=</span>k<span class="op">+</span><span class="dv">1</span>) <span class="co"># what&#39;s the first column?</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true"></a>  block1 &lt;-<span class="st"> </span>NN<span class="op">$</span>nn.idx[<span class="dv">1</span><span class="op">:</span>n1,<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true"></a>  block2 &lt;-<span class="st"> </span>NN<span class="op">$</span>nn.idx[(n1<span class="op">+</span><span class="dv">1</span>)<span class="op">:</span>n,<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true"></a>  i1 &lt;-<span class="st"> </span><span class="kw">sum</span>(block1 <span class="op">&lt;</span><span class="st"> </span>n1 <span class="op">+</span><span class="st"> </span><span class="fl">.5</span>); i2 &lt;-<span class="st"> </span><span class="kw">sum</span>(block2 <span class="op">&gt;</span><span class="st"> </span>n1<span class="fl">+.5</span>)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true"></a>  (i1 <span class="op">+</span><span class="st"> </span>i2) <span class="op">/</span><span class="st"> </span>(k <span class="op">*</span><span class="st"> </span>n)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true"></a>}</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true"></a>m &lt;-<span class="st"> </span><span class="fl">1e3</span>; k&lt;-<span class="dv">3</span>; p&lt;-<span class="dv">2</span>;<span class="kw">set.seed</span>(<span class="dv">12345</span>)</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true"></a>n1 &lt;-<span class="st"> </span>n2 &lt;-<span class="st"> </span><span class="dv">50</span>; R&lt;-<span class="dv">999</span>; n &lt;-<span class="st"> </span>n1<span class="op">+</span>n2; N =<span class="st"> </span><span class="kw">c</span>(n1,n2)</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true"></a>Sigma &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="dv">1</span>),<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true"></a>eqdist.nn &lt;-<span class="st"> </span><span class="cf">function</span>(z,sizes,k){</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true"></a>  boot.obj &lt;-<span class="st"> </span><span class="kw">boot</span>(<span class="dt">data=</span>z,<span class="dt">statistic=</span>Tn,<span class="dt">R=</span>R,</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true"></a>                   <span class="dt">sim =</span> <span class="st">&quot;permutation&quot;</span>, <span class="dt">sizes =</span> sizes,<span class="dt">k=</span>k)</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true"></a>  ts &lt;-<span class="st"> </span><span class="kw">c</span>(boot.obj<span class="op">$</span>t0,boot.obj<span class="op">$</span>t)</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true"></a>  p.value &lt;-<span class="st"> </span><span class="kw">mean</span>(ts<span class="op">&gt;=</span>ts[<span class="dv">1</span>])</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true"></a>  <span class="kw">list</span>(<span class="dt">statistic=</span>ts[<span class="dv">1</span>],<span class="dt">p.value=</span>p.value)</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true"></a>}</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true"></a>p.values &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>,m,<span class="dv">3</span>)</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>m){</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true"></a>  x &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rt</span>(n2<span class="op">*</span>p,<span class="dv">1</span>),<span class="dt">ncol=</span>p);</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true"></a>  y &lt;-<span class="st"> </span><span class="kw">mvrnorm</span>(<span class="dt">n=</span>n2, <span class="kw">rep</span>(<span class="dv">0</span>,<span class="dv">2</span>), Sigma);</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true"></a>  z &lt;-<span class="st"> </span><span class="kw">rbind</span>(x,y)</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true"></a>  p.values[i,<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw">eqdist.nn</span>(z,N,k)<span class="op">$</span>p.value</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true"></a>  p.values[i,<span class="dv">2</span>] &lt;-<span class="st"> </span><span class="kw">eqdist.etest</span>(z,<span class="dt">sizes=</span>N,<span class="dt">R=</span>R)<span class="op">$</span>p.value</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true"></a>  p.values[i,<span class="dv">3</span>] &lt;-<span class="st"> </span><span class="kw">bd.test</span>(<span class="dt">x=</span>x,<span class="dt">y=</span>y,<span class="dt">num.permutations=</span><span class="dv">999</span>,<span class="dt">seed=</span>i<span class="op">*</span><span class="dv">12345</span>)<span class="op">$</span>p.value</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true"></a>alpha &lt;-<span class="st"> </span><span class="fl">0.05</span>;</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true"></a>pow &lt;-<span class="st"> </span><span class="kw">colMeans</span>(p.values<span class="op">&lt;</span>alpha)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true"></a><span class="kw">matrix</span>(pow, <span class="dt">nrow=</span><span class="dv">1</span>,<span class="dt">dimnames=</span><span class="kw">list</span>(<span class="st">&quot;power&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;eqdist.nn&quot;</span>,<span class="st">&quot;eqdist.etest&quot;</span>,<span class="st">&quot;bd.test&quot;</span>)))</span></code></pre></div>
<pre><code>##       eqdist.nn eqdist.etest bd.test
## power     0.806        0.996   0.999</code></pre>
<p>The power of eqdist.etest is better. Ball could be more powerful for non-location family distribution</p>
<p>IIII Unbalanced samples (say, 1 case versus 10 controls)：n1=50,n2=500</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true"></a>Tn &lt;-<span class="st"> </span><span class="cf">function</span>(z, ix, sizes,k) {</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true"></a>  n1 &lt;-<span class="st"> </span>sizes[<span class="dv">1</span>]; n2 &lt;-<span class="st"> </span>sizes[<span class="dv">2</span>]; n &lt;-<span class="st"> </span>n1 <span class="op">+</span><span class="st"> </span>n2</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true"></a>  <span class="cf">if</span>(<span class="kw">is.vector</span>(z)) z &lt;-<span class="st"> </span><span class="kw">data.frame</span>(z,<span class="dv">0</span>);</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true"></a>  z &lt;-<span class="st"> </span>z[ix, ];</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true"></a>  NN &lt;-<span class="st"> </span><span class="kw">nn2</span>(<span class="dt">data=</span>z, <span class="dt">k=</span>k<span class="op">+</span><span class="dv">1</span>) <span class="co"># what&#39;s the first column?</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true"></a>  block1 &lt;-<span class="st"> </span>NN<span class="op">$</span>nn.idx[<span class="dv">1</span><span class="op">:</span>n1,<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true"></a>  block2 &lt;-<span class="st"> </span>NN<span class="op">$</span>nn.idx[(n1<span class="op">+</span><span class="dv">1</span>)<span class="op">:</span>n,<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true"></a>  i1 &lt;-<span class="st"> </span><span class="kw">sum</span>(block1 <span class="op">&lt;</span><span class="st"> </span>n1 <span class="op">+</span><span class="st"> </span><span class="fl">.5</span>); i2 &lt;-<span class="st"> </span><span class="kw">sum</span>(block2 <span class="op">&gt;</span><span class="st"> </span>n1<span class="fl">+.5</span>)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true"></a>  (i1 <span class="op">+</span><span class="st"> </span>i2) <span class="op">/</span><span class="st"> </span>(k <span class="op">*</span><span class="st"> </span>n)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true"></a>}</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true"></a>m &lt;-<span class="st"> </span><span class="fl">1e3</span>; k&lt;-<span class="dv">3</span>; p&lt;-<span class="dv">2</span>;<span class="kw">set.seed</span>(<span class="dv">12345</span>)</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true"></a>n1 &lt;-<span class="st"> </span><span class="dv">20</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true"></a>n2 &lt;-<span class="st"> </span><span class="dv">200</span>; R&lt;-<span class="dv">999</span>; n &lt;-<span class="st"> </span>n1<span class="op">+</span>n2; N =<span class="st"> </span><span class="kw">c</span>(n1,n2)</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true"></a>Sigma &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="dv">1</span>),<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true"></a>eqdist.nn &lt;-<span class="st"> </span><span class="cf">function</span>(z,sizes,k){</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true"></a>  boot.obj &lt;-<span class="st"> </span><span class="kw">boot</span>(<span class="dt">data=</span>z,<span class="dt">statistic=</span>Tn,<span class="dt">R=</span>R,</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true"></a>                   <span class="dt">sim =</span> <span class="st">&quot;permutation&quot;</span>, <span class="dt">sizes =</span> sizes,<span class="dt">k=</span>k)</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true"></a>  ts &lt;-<span class="st"> </span><span class="kw">c</span>(boot.obj<span class="op">$</span>t0,boot.obj<span class="op">$</span>t)</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true"></a>  p.value &lt;-<span class="st"> </span><span class="kw">mean</span>(ts<span class="op">&gt;=</span>ts[<span class="dv">1</span>])</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true"></a>  <span class="kw">list</span>(<span class="dt">statistic=</span>ts[<span class="dv">1</span>],<span class="dt">p.value=</span>p.value)</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true"></a>}</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true"></a>p.values &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>,m,<span class="dv">3</span>)</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>m){</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true"></a>  x &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rnorm</span>(n1<span class="op">*</span>p),<span class="dt">ncol=</span>p);</span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true"></a>  y &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rnorm</span>(n2<span class="op">*</span>p),<span class="dt">ncol=</span>p);</span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true"></a>  z &lt;-<span class="st"> </span><span class="kw">rbind</span>(x,y)</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true"></a>  p.values[i,<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw">eqdist.nn</span>(z,N,k)<span class="op">$</span>p.value</span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true"></a>  p.values[i,<span class="dv">2</span>] &lt;-<span class="st"> </span><span class="kw">eqdist.etest</span>(z,<span class="dt">sizes=</span>N,<span class="dt">R=</span>R)<span class="op">$</span>p.value</span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true"></a>  p.values[i,<span class="dv">3</span>] &lt;-<span class="st"> </span><span class="kw">bd.test</span>(<span class="dt">x=</span>x,<span class="dt">y=</span>y,<span class="dt">num.permutations=</span><span class="dv">999</span>,<span class="dt">seed=</span>i<span class="op">*</span><span class="dv">12345</span>)<span class="op">$</span>p.value</span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true"></a>alpha &lt;-<span class="st"> </span><span class="fl">0.1</span>;</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true"></a>pow &lt;-<span class="st"> </span><span class="kw">colMeans</span>(p.values<span class="op">&lt;</span>alpha)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true"></a><span class="kw">matrix</span>(pow, <span class="dt">nrow=</span><span class="dv">1</span>,<span class="dt">dimnames=</span><span class="kw">list</span>(<span class="st">&quot;power&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;eqdist.nn&quot;</span>,<span class="st">&quot;eqdist.etest&quot;</span>,<span class="st">&quot;bd.test&quot;</span>)))</span></code></pre></div>
<pre><code>##       eqdist.nn eqdist.etest bd.test
## power     0.084        0.093   0.089</code></pre>
<p>It can be seen that for unbalanced samples, the efficacy of the three is not very good</p>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
